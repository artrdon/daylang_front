import { useState, useEffect } from 'react'
import { Routes, Route, Link } from 'react-router-dom'
import { useQuery } from '@tanstack/react-query';
import App from '/src/App.jsx'
import AppLoad from '/src/AppLoad.jsx'
import axios from 'axios';
import APIURL from '/api.js'
import WSAPIURL from '/wsapi.js';


function Confident() {

    
  const [groups, setGroup] = useState([0]);
  const [ws, setWs] = useState(null);
  const [messNumb, setMessNumb] = useState(null);

useEffect(() => {

    const socket = new WebSocket(`${WSAPIURL}/ws/some_path/${groups.join(',')}/`);

    socket.onopen = () => {
        console.log('WebSocket connected');
    };

    socket.onmessage = (event) => {
        const dataMess = JSON.parse(event.data);

        console.log(dataMess);
        if (dataMess.tip === "delete"){
            let i_read = true;
            for (let i = 0; dataMess.if_readed.length > i; i++){
                console.log(dataMess.if_readed[i]);
                console.log(data.username);
                if (dataMess.if_readed[i] === data.username){
                  console.log("i_read");
                  i_read = false;
                }
            }
            if (i_read)
              setMessNumb(prev => prev - 1);
            return;
        }

        if (dataMess.tip === "send"){
            setMessNumb(prev => prev + 1);
            return;
        }

         //   document.getElementById("mesfield").scrollTo(0, document.getElementById("mesfield").scrollHeight);
    };

    socket.onclose = () => {
      console.log('WebSocket disconnected');
    };

    socket.onerror = (error) => {
      console.error('WebSocket error:', error);
    };

    setWs(socket);

    return () => {
      socket.close();
    };
  }, [groups]);


    const [count, setCount] = useState(0)
    document.querySelector("title").textContent = "Personal data policy";

const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

axios.defaults.withCredentials = true;


function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}


const theme = getCookie('theme');
//console.log(getCookie('theme'));


if (getCookie('theme') === "dark"){
  if (document.querySelector('body') != null)
      document.querySelector('body').className = "dark_theme";
}
else{
  if (document.querySelector('body') != null)
      document.querySelector('body').className = "light_theme";
}


function change_theme() {
  if (document.querySelector('body').className === "dark_theme")
  {

      document.querySelector('body').className = "light_theme";
      document.cookie = "theme=light; path=/;max-age=31556926";
      document.getElementById('theme_img').setAttribute("src", `/src/static/img/sunce.png`);
  }
  else
  {
      document.querySelector('body').className = "dark_theme";
      document.cookie = "theme=dark; path=/;max-age=31556926";
      document.getElementById('theme_img').setAttribute("src", `/src/static/img/moon.png`);
  }
}


    const lang = getCookie('lang');
    let [langua, setData10] = useState(null);

    langua = lang;

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await axios.get(`${APIURL}/userinfo/`);
        setData(response.data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);


 
  const { data: data12, isLoading: loading12, isError: error12, error: errorDetails12  } = useQuery({
    queryKey: [`getchatlist`], // Уникальный ключ запроса
    queryFn: async () => {
      const response = await axios.get(`${APIURL}/getchatlist/`);

      if (response.data != null){
          let group = [];
          for (let i = 0; i < response.data[0].length; i++){
              //setGroup((groups) => [...groups, response.data[0][i].id]);
              group.unshift(response.data[0][i].id);
          }
          setGroup(group);
      }
      setMessNumb(response.data[1]);
      return response.data; // Возвращаем только данные
    },
    // Опциональные параметры:
    retry: 2, // Количество попыток повтора при ошибке
    staleTime: 1000 * 60 * 5, // Данные считаются свежими 5 минут
    refetchOnWindowFocus: false, // Отключаем повторный запрос при фокусе окна
  });

  if (loading) return (
      <>
      <AppLoad lang={langua}/>
</>

  );
  if (error) return <p>Error: {error}</p>;

  if (loading12) return (
      <>
      <AppLoad lang={langua}/>
</>

  );
  if (error12) return <p>Error: {error12}</p>;


    return (
        <>
<App name={data.first_name} lastname={data.last_name} username={data.username} lang={langua} if_teach={data.i_am_teacher} mess_count={data12[1]} photo={data.photo} balance={data.balance}/>

<div className="ctr_offer_find_panel">
  <div style={{ display: "flex", justifyContent: "center" }}>
    <div style={{ display: "flex", justifyContent: "center" }}>
      <div className="crt_offer_gray_thing">
        <div className="crt_offer_blank">
          <div style={{ width: 570, marginLeft: "auto", marginRight: "auto", position: "relative", fontSize: 20 }}>
              <br />
            <h1 className="privacy-title">Политика в отношении обработки персональных данных</h1>

        {/* Раздел 1 */}
        <div className="privacy-section">
          <h2 className="section-title">1. Общие положения</h2>
          <p>1.1. Настоящая политика обработки персональных данных составлена в соответствии с требованиями Федерального закона от 27.07.2006. № 152-ФЗ «О персональных данных» и определяет порядок обработки персональных данных и меры по обеспечению безопасности персональных данных, предпринимаемые ООО "ДЭЙЛЭНГ" (далее — Оператор).</p>
          <p>1.2. Оператор ставит своей важнейшей целью и условием осуществления своей деятельности соблюдение прав и свобод человека и гражданина при обработке его персональных данных, в том числе защиты прав на неприкосновенность частной жизни, личную и семейную тайну.</p>
          <p>1.3. Настоящая политика Оператора в отношении обработки персональных данных (далее — Политика) применяется ко всей информации, которую Оператор может получить о посетителях веб-сайта https://daylang.ru.</p>
        </div>

        {/* Раздел 2 */}
        <div className="privacy-section">
          <h2 className="section-title">2. Основные понятия, используемые в Политике</h2>
          <p><strong>2.1. Автоматизированная обработка персональных данных</strong> — обработка персональных данных с помощью средств вычислительной техники.</p>
          <p><strong>2.2. Блокирование персональных данных</strong> — временное прекращение обработки персональных данных (за исключением случаев, если обработка необходима для уточнения персональных данных).</p>
          <p><strong>2.3. Веб-сайт</strong> — совокупность графических и информационных материалов, а также программ для ЭВМ и баз данных, обеспечивающих их доступность в сети интернет по сетевому адресу https://daylang.ru.</p>
          <p><strong>2.4. Информационная система персональных данных</strong> — совокупность содержащихся в базах данных персональных данных и обеспечивающих их обработку информационных технологий и технических средств.</p>
          <p><strong>2.5. Обезличивание персональных данных</strong> — действия, в результате которых невозможно определить без использования дополнительной информации принадлежность персональных данных конкретному Пользователю или иному субъекту персональных данных.</p>
          <p><strong>2.6. Обработка персональных данных</strong> — любое действие (операция) или совокупность действий (операций), совершаемых с использованием средств автоматизации или без использования таких средств с персональными данными, включая сбор, запись, систематизацию, накопление, хранение, уточнение (обновление, изменение), извлечение, использование, передачу (распространение, предоставление, доступ), обезличивание, блокирование, удаление, уничтожение персональных данных.</p>
          <p><strong>2.7. Оператор</strong> — государственный орган, муниципальный орган, юридическое или физическое лицо, самостоятельно или совместно с другими лицами организующие и/или осуществляющие обработку персональных данных, а также определяющие цели обработки персональных данных, состав персональных данных, подлежащих обработке, действия (операции), совершаемые с персональными данными.</p>
          <p><strong>2.8. Персональные данные</strong> — любая информация, относящаяся прямо или косвенно к определенному или определяемому Пользователю веб-сайта https://daylang.ru.</p>
          <p><strong>2.9. Персональные данные, разрешенные субъектом персональных данных для распространения</strong> — персональные данные, доступ неограниченного круга лиц к которым предоставлен субъектом персональных данных путем дачи согласия на обработку персональных данных, разрешенных субъектом персональных данных для распространения в порядке, предусмотренном Законом о персональных данных.</p>
          <p><strong>2.10. Пользователь</strong> — любой посетитель веб-сайта https://daylang.ru.</p>
          <p><strong>2.11. Предоставление персональных данных</strong> — действия, направленные на раскрытие персональных данных определенному лицу или определенному кругу лиц.</p>
          <p><strong>2.12. Распространение персональных данных</strong> — любые действия, направленные на раскрытие персональных данных неопределенному кругу лиц.</p>
          <p><strong>2.13. Трансграничная передача персональных данных</strong> — передача персональных данных на территорию иностранного государства.</p>
          <p><strong>2.14. Уничтожение персональных данных</strong> — любые действия, в результате которых персональные данные уничтожаются безвозвратно.</p>
        </div>

        {/* Раздел 3 */}
        <div className="privacy-section">
          <h2 className="section-title">3. Основные права и обязанности Оператора</h2>
          <p><strong>3.1. Оператор имеет право:</strong></p>
          <ul className="policy-list">
            <li>получать от субъекта персональных данных достоверные информацию и/или документы, содержащие персональные данные;</li>
            <li>в случае отзыва субъектом персональных данных согласия на обработку персональных данных, Оператор вправе продолжить обработку персональных данных без согласия субъекта персональных данных при наличии оснований;</li>
            <li>самостоятельно определять состав и перечень мер, необходимых и достаточных для обеспечения выполнения обязанностей.</li>
          </ul>

          <p><strong>3.2. Оператор обязан:</strong></p>
          <ul className="policy-list">
            <li>предоставлять субъекту персональных данных по его просьбе информацию;</li>
            <li>организовывать обработку персональных данных в порядке, установленном действующим законодательством РФ;</li>
            <li>отвечать на обращения и запросы субъектов персональных данных;</li>
            <li>сообщать в уполномоченный орган по защите прав субъектов персональных данных необходимую информацию;</li>
            <li>публиковать или иным образом обеспечивать неограниченный доступ к настоящей Политике;</li>
            <li>принимать правовые, организационные и технические меры для защиты персональных данных;</li>
            <li>прекратить передачу персональных данных, прекратить обработку и уничтожить персональные данные в установленных случаях;</li>
            <li>исполнять иные обязанности, предусмотренные законодательством.</li>
          </ul>
        </div>

        {/* Раздел 4 */}
        <div className="privacy-section">
          <h2 className="section-title">4. Основные права и обязанности субъектов персональных данных</h2>
          <p><strong>4.1. Субъекты персональных данных имеют право:</strong></p>
          <ul className="policy-list">
            <li>получать информацию, касающуюся обработки его персональных данных;</li>
            <li>требовать от оператора уточнения его персональных данных, их блокирования или уничтожения;</li>
            <li>выдвигать условие предварительного согласия при обработке персональных данных в целях продвижения на рынке товаров, работ и услуг;</li>
            <li>на отзыв согласия на обработку персональных данных;</li>
            <li>обжаловать в уполномоченный орган или в судебном порядке неправомерные действия или бездействие Оператора;</li>
            <li>на осуществление иных прав, предусмотренных законодательством РФ.</li>
          </ul>

          <p><strong>4.2. Субъекты персональных данных обязаны:</strong></p>
          <ul className="policy-list">
            <li>предоставлять Оператору достоверные данные о себе;</li>
            <li>сообщать Оператору об уточнении (обновлении, изменении) своих персональных данных.</li>
          </ul>

          <p>4.3. Лица, передавшие Оператору недостоверные сведения о себе, несут ответственность в соответствии с законодательством РФ.</p>
        </div>

        {/* Раздел 5 */}
        <div className="privacy-section">
          <h2 className="section-title">5. Принципы обработки персональных данных</h2>
          <p>5.1. Обработка персональных данных осуществляется на законной и справедливой основе.</p>
          <p>5.2. Обработка персональных данных ограничивается достижением конкретных, заранее определенных и законных целей.</p>
          <p>5.3. Не допускается объединение баз данных, содержащих персональные данные, обработка которых осуществляется в целях, несовместимых между собой.</p>
          <p>5.4. Обработке подлежат только персональные данные, которые отвечают целям их обработки.</p>
          <p>5.5. Содержание и объем обрабатываемых персональных данных соответствуют заявленным целям обработки.</p>
          <p>5.6. При обработке персональных данных обеспечивается точность персональных данных, их достаточность, а в необходимых случаях и актуальность.</p>
          <p>5.7. Хранение персональных данных осуществляется в форме, позволяющей определить субъекта персональных данных, не дольше, чем этого требуют цели обработки.</p>
        </div>

        {/* Раздел 6 */}
        <div className="privacy-section">
          <h2 className="section-title">6. Цели обработки персональных данных</h2>
          <table className="policy-table">
            <thead>
              <tr>
                <th>Цель обработки</th>
                <th>Персональные данные</th>
                <th>Правовые основания</th>
                <th>Виды обработки</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Предоставление доступа Пользователю к сервисам</td>
                <td>ФИО, email, фотографии</td>
                <td>Договоры с субъектом персональных данных</td>
                <td>Сбор, запись, хранение, уничтожение</td>
              </tr>
            </tbody>
          </table>
        </div>

        {/* Раздел 7 */}
        <div className="privacy-section">
          <h2 className="section-title">7. Условия обработки персональных данных</h2>
          <p>7.1. Обработка персональных данных осуществляется с согласия субъекта персональных данных.</p>
          <p>7.2. Обработка персональных данных необходима для достижения целей, предусмотренных международным договором или законом.</p>
          <p>7.3. Обработка персональных данных необходима для осуществления правосудия.</p>
          <p>7.4. Обработка персональных данных необходима для исполнения договора.</p>
          <p>7.5. Обработка персональных данных необходима для осуществления прав и законных интересов оператора.</p>
          <p>7.6. Осуществляется обработка персональных данных, доступ к которым предоставлен субъектом персональных данных.</p>
          <p>7.7. Осуществляется обработка персональных данных, подлежащих опубликованию в соответствии с федеральным законом.</p>
        </div>

        {/* Раздел 8 */}
        <div className="privacy-section">
          <h2 className="section-title">8. Порядок сбора, хранения, передачи и других видов обработки персональных данных</h2>
          <p>8.1. Оператор обеспечивает сохранность персональных данных и принимает все возможные меры, исключающие доступ к персональным данным неуполномоченных лиц.</p>
          <p>8.2. Персональные данные Пользователя никогда не будут переданы третьим лицам, за исключением случаев, связанных с исполнением законодательства.</p>
          <p>8.3. В случае выявления неточностей в персональных данных, Пользователь может актуализировать их самостоятельно.</p>
          <p>8.4. Срок обработки персональных данных определяется достижением целей, для которых были собраны персональные данные.</p>
          <p>8.5. Пользователь может в любой момент отозвать свое согласие на обработку персональных данных.</p>
          <p>8.6. Вся информация, которая собирается сторонними сервисами, хранится и обрабатывается указанными лицами в соответствии с их Политикой конфиденциальности.</p>
          <p>8.7. Оператор при обработке персональных данных обеспечивает конфиденциальность персональных данных.</p>
          <p>8.8. Оператор осуществляет хранение персональных данных в форме, позволяющей определить субъекта персональных данных.</p>
          <p>8.9. Условием прекращения обработки персональных данных может являться достижение целей обработки.</p>
        </div>

        {/* Раздел 9 */}
        <div className="privacy-section">
          <h2 className="section-title">9. Перечень действий, производимых Оператором с полученными персональными данными</h2>
          <p>9.1. Оператор осуществляет сбор, запись, систематизацию, накопление, хранение, уточнение (обновление, изменение).</p>
          <p>9.2. Оператор осуществляет автоматизированную обработку персональных данных с получением и/или передачей полученной информации.</p>
        </div>

        {/* Раздел 10 */}
        <div className="privacy-section">
          <h2 className="section-title">10. Трансграничная передача персональных данных</h2>
          <p>10.1. Оператор до начала осуществления трансграничной передачи персональных данных обязан уведомить уполномоченный орган.</p>
          <p>10.2. Оператор до подачи уведомления обязан получить соответствующие сведения от органов власти иностранного государства.</p>
        </div>

        {/* Раздел 11 */}
        <div className="privacy-section">
          <h2 className="section-title">11. Конфиденциальность персональных данных</h2>
          <p>Оператор и иные лица, получившие доступ к персональным данным, обязаны не раскрывать третьим лицам и не распространять персональные данные без согласия субъекта персональных данных, если иное не предусмотрено федеральным законом.</p>
        </div>

        {/* Раздел 12 */}
        <div className="privacy-section">
          <h2 className="section-title">12. Заключительные положения</h2>
          <p>12.1. Пользователь может получить любые разъяснения по интересующим вопросам, касающимся обработки его персональных данных, обратившись к Оператору с помощью электронной почты sinmak.show@bk.ru.</p>
          <p>12.2. В данном документе будут отражены любые изменения политики обработки персональных данных Оператором. Политика действует бессрочно до замены ее новой версией.</p>
          <p>12.3. Актуальная версия Политики в свободном доступе расположена в сети Интернет по адресу https://daylang.ru/privacy.</p>
        </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


</>

  )
}

export default Confident
